<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Cryptocurrencies for Investment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #ddd;
            margin: 0;
            padding: 0;
            background-image: url('/static/background.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        h1 {
            text-align: center;
            color: #4CAF50;
            margin-top: 50px;
        }
        .sorting-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
            max-height: 600px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: rgba(0, 0, 0, 0.7);
            color: #ddd;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: rgba(76, 175, 80, 0.7);
            color: white;
            position: sticky;
            top: 0;
            z-index: 2;
        }
        td:first-child {
            position: sticky;
            left: 0;
            z-index: 1;
            background-color: rgba(0, 0, 0, 0.7);
        }
        tr:nth-child(even) {
            background-color: rgba(51, 51, 51, 0.7);
        }
        tr:hover {
            background-color: rgba(85, 85, 85, 0.7);
        }
        select {
            width: 100%;
            height: 40px;
            font-size: 16px;
            padding: 12px 20px;
            border: 1px solid #ddd;
            margin-bottom: 12px;
        }
        button {
            height: 40px;
            font-size: 16px;
            padding: 0 20px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .pagination a {
            color: white;
            float: left;
            padding: 8px 16px;
            text-decoration: none;
            background-color: #4CAF50;
            margin: 0 4px;
        }
        .pagination a.active {
            background-color: #4CAF50;
            color: white;
        }
        .pagination a:hover:not(.active) {
            background-color: #555;
        }
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        table.crypto-table tbody tr {
            animation: fadeIn 0.6s ease-out;
        }
        .sentiment-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .sentiment-indicator.positive {
            background-color: green;
        }
        .sentiment-indicator.negative {
            background-color: red;
        }
        .sentiment-indicator.neutral {
            background-color: gray;
        }
        .sentiment-text {
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <h1>Top Cryptocurrencies for Investment</h1>
    <div class="sorting-container">
        <form id="sortForm" method="GET" action="/">
            <label for="sort_field">Sort by:</label>
            <select id="sort_field" name="sort_field">
                <option value="name" {% if sort_field == 'name' %}selected{% endif %}>Name</option>
                <option value="current_price" {% if sort_field == 'current_price' %}selected{% endif %}>Current Price</option>
                <option value="expected_return" {% if sort_field == 'expected_return' %}selected{% endif %}>Expected Return</option>
                <option value="high_24h" {% if sort_field == 'high_24h' %}selected{% endif %}>High 24h</option>
                <option value="low_24h" {% if sort_field == 'low_24h' %}selected{% endif %}>Low 24h</option>
                <option value="last_updated" {% if sort_field == 'last_updated' %}selected{% endif %}>Last Updated</option>
                <option value="price_change_24h" {% if sort_field == 'price_change_24h' %}selected{% endif %}>Price Change 24h</option>
                <option value="price_change_percentage_24h" {% if sort_field == 'price_change_percentage_24h' %}selected{% endif %}>Price Change % 24h</option>
                <option value="ath" {% if sort_field == 'ath' %}selected{% endif %}>ATH</option>
                <option value="ath_date" {% if sort_field == 'ath_date' %}selected{% endif %}>ATH Date</option>
                <option value="ath_change_percentage" {% if sort_field == 'ath_change_percentage' %}selected{% endif %}>ATH Change %</option>
                <option value="atl_change_percentage" {% if sort_field == 'atl_change_percentage' %}selected{% endif %}>ATL Change %</option>
                <option value="market_cap" {% if sort_field == 'market_cap' %}selected{% endif %}>Market Cap</option>
                <option value="market_cap_change_24h" {% if sort_field == 'market_cap_change_24h' %}selected{% endif %}>Market Cap Change 24h</option>
                <option value="market_cap_change_percentage_24h" {% if sort_field == 'market_cap_change_percentage_24h' %}selected{% endif %}>Market Cap Change % 24h</option>
                <option value="market_cap_rank" {% if sort_field == 'market_cap_rank' %}selected{% endif %}>Market Cap Rank</option>
                <option value="circulating_supply" {% if sort_field == 'circulating_supply' %}selected{% endif %}>Circulating Supply</option>
                <option value="price_day_1" {% if sort_field == 'price_day_1' %}selected{% endif %}>Price Day 1</option>
                <option value="price_day_2" {% if sort_field == 'price_day_2' %}selected{% endif %}>Price Day 2</option>
                <option value="price_day_3" {% if sort_field == 'price_day_3' %}selected{% endif %}>Price Day 3</option>
                <option value="price_day_4" {% if sort_field == 'price_day_4' %}selected{% endif %}>Price Day 4</option>
                <option value="price_day_5" {% if sort_field == 'price_day_5' %}selected{% endif %}>Price Day 5</option>
                <option value="price_day_6" {% if sort_field == 'price_day_6' %}selected{% endif %}>Price Day 6</option>
                <option value="price_day_7" {% if sort_field == 'price_day_7' %}selected{% endif %}>Price Day 7</option>
            </select>
            <select id="sort_order" name="sort_order">
                <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>Ascending</option>
                <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>Descending</option>
            </select>
            <button type="submit">Sort</button>
        </form>
    </div>
    <div class="table-container">
        <table id="myTable" class="crypto-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Current Price (₹)</th>
                    <th>Expected Return (₹)</th>
                    <th>High 24h (₹)</th>
                    <th>Low 24h (₹)</th>
                    <th>Last Updated</th>
                    <th>Price Change 24h</th>
                    <th>Price Change % 24h</th>
                    <th>ATH (₹)</th>
                    <th>ATH Date</th>
                    <th>ATH Change %</th>
                    <th>ATL Change %</th>
                    <th>Market Cap (₹)</th>
                    <th>Market Cap Change 24h</th>
                    <th>Market Cap Change % 24h</th>
                    <th>Market Cap Rank</th>
                    <th>Circulating Supply</th>
                    <th>Price Day 1 (₹)</th>
                    <th>Price Day 2 (₹)</th>
                    <th>Price Day 3 (₹)</th>
                    <th>Price Day 4 (₹)</th>
                    <th>Price Day 5 (₹)</th>
                    <th>Price Day 6 (₹)</th>
                    <th>Price Day 7 (₹)</th>
                    <th>Sentiment</th>
                    <th>Candlestick Graph</th>
                </tr>
            </thead>
            <tbody id="cryptoTableBody">
                <!-- Table rows will be populated dynamically -->
                {% for coin in top_investments %}
                    <tr>
                        <td>{{ coin["name"] }}</td>
                        <td>₹ {{ coin["current_price"] }}</td>
                        <td>₹ {{ coin["expected_return"] }}</td>
                        <td>₹ {{ coin["high_24h"] }}</td>
                        <td>₹ {{ coin["low_24h"] }}</td>
                        <td>{{ coin["last_updated"] }}</td>
                        <td>{{ coin["price_change_24h"] }}</td>
                        <td>{{ coin["price_change_percentage_24h"] }}%</td>
                        <td>₹ {{ coin["ath"] }}</td>
                        <td>{{ coin["ath_date"] }}</td>
                        <td>{{ coin["ath_change_percentage"] }}%</td>
                        <td>{{ coin["atl_change_percentage"] }}%</td>
                        <td>₹ {{ coin["market_cap"] }}</td>
                        <td>{{ coin["market_cap_change_24h"] }}</td>
                        <td>{{ coin["market_cap_change_percentage_24h"] }}%</td>
                        <td>{{ coin["market_cap_rank"] }}</td>
                        <td>{{ coin["circulating_supply"] }}</td>
                        <td>₹ {{ coin["price_day_1"] }}</td>
                        <td>₹ {{ coin["price_day_2"] }}</td>
                        <td>₹ {{ coin["price_day_3"] }}</td>
                        <td>₹ {{ coin["price_day_4"] }}</td>
                        <td>₹ {{ coin["price_day_5"] }}</td>
                        <td>₹ {{ coin["price_day_6"] }}</td>
                        <td>₹ {{ coin["price_day_7"] }}</td>
                        <td>
                            {% if coin["sentiment"] == 'positive' %}
                                <div class="sentiment-indicator positive" title="Positive"></div>
                                <span class="sentiment-text">Positive</span>
                            {% elif coin["sentiment"] == 'negative' %}
                                <div class="sentiment-indicator negative" title="Negative"></div>
                                <span class="sentiment-text">Negative</span>
                            {% else %}
                                <div class="sentiment-indicator neutral" title="Neutral"></div>
                                <span class="sentiment-text">Neutral</span>
                            {% endif %}
                        </td>
                        <td><a href="/candlestick/{{ coin["id"] }}">View Candlestick Graph</a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="pagination">
        {% if page > 1 %}
            <a href="/?page={{ page - 1 }}&sort_field={{ sort_field }}&sort_order={{ sort_order }}">&laquo; Previous</a>
        {% endif %}
        {% for i in range(1, (total // per_page) + 2) %}
            <a href="/?page={{ i }}&sort_field={{ sort_field }}&sort_order={{ sort_order }}" class="{{ 'active' if i == page else '' }}">{{ i }}</a>
        {% endfor %}
        {% if page < (total // per_page) + 1 %}
            <a href="/?page={{ page + 1 }}&sort_field={{ sort_field }}&sort_order={{ sort_order }}">Next &raquo;</a>
        {% endif %}
    </div>

    <script>
        // Function to fetch data from backend and update the table
        function fetchDataAndUpdate() {
            fetch('/fetch_data') // Replace with your backend endpoint that fetches data from Redis or other source
                .then(response => response.json())
                .then(data => {
                    const cryptoTableBody = document.getElementById('cryptoTableBody');
                    cryptoTableBody.innerHTML = ''; // Clear existing table rows
                    data.top_investments.forEach(coin => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${coin.name}</td>
                            <td>₹ ${coin.current_price}</td>
                            <td>₹ ${coin.expected_return}</td>
                            <td>₹ ${coin.high_24h}</td>
                            <td>₹ ${coin.low_24h}</td>
                            <td>${coin.last_updated}</td>
                            <td>${coin.price_change_24h}</td>
                            <td>${coin.price_change_percentage_24h}%</td>
                            <td>₹ ${coin.ath}</td>
                            <td>${coin.ath_date}</td>
                            <td>${coin.ath_change_percentage}%</td>
                            <td>${coin.atl_change_percentage}%</td>
                            <td>₹ ${coin.market_cap}</td>
                            <td>${coin.market_cap_change_24h}</td>
                            <td>${coin.market_cap_change_percentage_24h}%</td>
                            <td>${coin.market_cap_rank}</td>
                            <td>${coin.circulating_supply}</td>
                            <td>₹ ${coin.price_day_1}</td>
                            <td>₹ ${coin.price_day_2}</td>
                            <td>₹ ${coin.price_day_3}</td>
                            <td>₹ ${coin.price_day_4}</td>
                            <td>₹ ${coin.price_day_5}</td>
                            <td>₹ ${coin.price_day_6}</td>
                            <td>₹ ${coin.price_day_7}</td>
                            <td>
                                ${coin.sentiment === 'positive' ? '<div class="sentiment-indicator positive" title="Positive"></div><span class="sentiment-text">Positive</span>'
                                : coin.sentiment === 'negative' ? '<div class="sentiment-indicator negative" title="Negative"></div><span class="sentiment-text">Negative</span>'
                                : '<div class="sentiment-indicator neutral" title="Neutral"></div><span class="sentiment-text">Neutral</span>'}
                            </td>
                            <td><a href="/candlestick/${coin.id}">View Candlestick Graph</a></td>
                        `;
                        cryptoTableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Initial data fetch and update
        fetchDataAndUpdate();

        // Refresh data every 2 minutes (adjust as needed)
        setInterval(fetchDataAndUpdate, 2 * 60 * 1000); // 2 minutes in milliseconds
    </script>
</body>
</html>
